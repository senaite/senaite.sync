<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="senaite">
  <head>
    <metal:block fill-slot="javascript_head_slot"
                 tal:define="portal context/@@plone_portal_state/portal;">
    </metal:block>
  </head>
  <body>

    <metal:title fill-slot="content-title">
      <h1 i18n:translate="">
        SENAITE SYNC
      </h1>
    </metal:title>
    <metal:description fill-slot="content-description">
      <p i18n:translate="">
      </p>
    </metal:description>

    <div metal:fill-slot="content-core"
         tal:define="portal context/@@plone_portal_state/portal;">

      <form id="fetch_form"
            name="fetch_form"
            method="POST">

        <input type="hidden" name="fetchform" value="1"/>
        <span tal:replace="structure context/@@authenticator/authenticator"/>

        <!-- Domain Name -->
        <div class="field form-group field">
          <label i18n:translate=""
                 class="form-control-label"
                 for="domain_name">
            Domain Name
            <span class="required"></span>
            <span i18n:translate=""
                  class="help formHelp">
              Representative unique name for the source system.
            </span>
          </label>
          <div class="form-group input-group">
            <span class="input-group-addon"><i class="glyphicon glyphicon-link"></i></span>
            <input type="text" size="30"
                   class="form-control"
                   id="domain_name"
                   tal:attributes="value view/domain_name|nothing"
                   name="domain_name"/>
          </div>
        </div>

        <!-- Base URL -->
        <div class="field form-group field">
          <label i18n:translate=""
                 class="form-control-label"
                 for="url">
            Source URL
            <span class="required"></span>
            <span i18n:translate=""
                  class="help formHelp">
              The base URL of the source system, e.g. http://localhost:1337/senaitelims
            </span>
          </label>
          <div class="form-group input-group">
            <span class="input-group-addon"><i class="glyphicon glyphicon-link"></i></span>
            <input type="text" size="30"
                   class="form-control"
                   id="url"
                   tal:attributes="value view/url|nothing"
                   name="url"/>
          </div>
        </div>

        <!-- Username -->
        <div class="field form-group field">
          <label i18n:translate=""
                 class="form-control-label"
                 for="ac_name">
            Username
            <span class="required"></span>
            <span i18n:translate=""
                  class="help formHelp">
              The username to login into the source system
            </span>
          </label>
          <div class="form-group input-group">
            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
            <input type="text"
                   size="30"
                   autocomplete="new-username"
                   class="form-control"
                   id="ac_name"
                   tal:attributes="value view/username|nothing"
                   name="ac_name"/>
          </div>
        </div>

        <!-- Password -->
        <div class="field form-group field">
          <label i18n:translate=""
                 class="form-control-label"
                 for="ac_password">
            Password
            <span class="required"></span>
            <span i18n:translate=""
                  class="help formHelp">
              The password to login into the source system
            </span>
          </label>
          <div class="form-group input-group">
            <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
            <input type="password"
                   autocomplete="new-password"
                   size="30"
                   class="form-control"
                   id="ac_password"
                   tal:attributes="value view/password|nothing"
                   name="ac_password"/>
          </div>
        </div>

        <!-- Import configuration -->
        <div class="field form-group field">
          <div class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                 <a data-toggle="collapse" href="#collapse1">Show import configuration</a>
               </h4>
              </div>
              <div id="collapse1" class="panel-collapse collapse">
                <ul class="list-group">
                  <li class="list-group-item">
                    <div>
                      <input type="checkbox"
                             name="import_settings"
                             id="import_settings"/>
	     	          <label for="import_settings">Import Settings</label>
	                </div>
                  </li>
                  <li class="list-group-item">
                    <div>
                      <input type="checkbox"
                             name="import_registry"
                             id="import_registry"/>
	     	          <label for="import_registry">Import Registry</label>
	                </div>
                  </li>
                  <li class="list-group-item">
                    <div>
                      <input type="checkbox"
                             name="import_users"
                             id="import_users"/>
	     	          <label for="import_users">Import Users</label>
	                </div>
                  </li>
                  <li class="list-group-item">
                    <!-- Content Types -->
                    <div class="field form-group field">
                      <label i18n:translate=""
                             class="form-control-label"
                             for="content_types">
                        Content Types
                        <span i18n:translate=""
                              class="help formHelp">
                          If filled, only indicated Content Types (separated by comma) will be imported. E.g: 'Sample, Client, Worksheet'
                        </span>
                      </label>
                      <div class="form-group input-group">
                        <input type="text"
                               size="45"
                               class="form-control"
                               id="content_types"
                               tal:attributes="value view/content_types|nothing"
                               name="content_types"/>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <input class="btn btn-success btn-sm allowMultiSubmit"
               type="submit"
               name="fetch"
               i18n:attributes="value"
               value="Fetch"/>

      </form>

      <!-- Storage View -->
      <tal:storage repeat="storage view/storage">
        <form
          name="data_form"
          method="POST">

          <dl class="collapsible">

            <dt class="collapsibleHeader">
              Data for <span tal:replace="storage"/>
              (<span tal:replace="python:len(view.storage[storage]['ordered_uids'])"/> Items)
            </dt>
            <input type="hidden" name="dataform" value="1"/>
            <input type="hidden" name="domain_name" value="" tal:attributes="value storage" />

            <dd class="collapsibleContent">
              <div>
                  Import settings: <span tal:replace="python:view.storage[storage]['configuration'].get('import_settings')"/>
                  Import registry: <span tal:replace="python:view.storage[storage]['configuration'].get('import_registry')"/>
                  Import users: <span tal:replace="python:view.storage[storage]['configuration'].get('import_users')"/>
              </div><br>
              <input class="btn btn-default btn-sm"
                     type="submit"
                     name="import"
                     i18n:attributes="value"
                     value="Import"/>

              <input class="btn btn-default btn-sm"
                     type="submit"
                     onclick="return confirm('Are you sure you want to delete all the fetched data?');"
                     name="clear_storage"
                     i18n:attributes="value"
                     value="Clear this Storage"/>
              <div>
                  <dl class="collapsible">
                      <dt class="collapsibleHeader">
                          Complement Step
                      </dt>
                      <dd class="collapsibleContent">
                          <div class="field form-group field">
                              <label i18n:translate=""
                                     class="form-control-label"
                                     for="mod_date_limit">
                                Modification Date Limit
                                <span i18n:translate=""
                                      class="help formHelp">
                                  If filled, complement step will run for the objects created/modified after this time.
                                </span>
                              </label>
                              <div class="form-group input-group">
                                <input type="text"
                                       size="25"
                                       class="form-control"
                                       id="mod_date_limit"
                                       name="mod_date_limit"/>
                                </div>
                          </div>
                          <input class="btn btn-default btn-sm"
                                 type="submit"
                                 name="complement"
                                 i18n:attributes="value"
                                 value="Complement"/>
                      </dd>
                  </dl>
              </div>
            </dd>
          </dl>
        </form>
      </tal:storage>

    </div>

  </body>
</html>
